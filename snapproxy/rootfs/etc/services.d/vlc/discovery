#!/usr/bin/with-contenv bashio
# ==============================================================================
# Send vlc_telnet discovery information to Home Assistant
# ==============================================================================
# Copied directly from: https://github.com/home-assistant/addons/blob/master/vlc/rootfs/etc/services.d/vlc/discovery
# and changed to include some extra data
declare ha_config

# Prepare discovery payload
ha_config=$(\
    bashio::var.json \
        host "$(hostname)" \
        port "^4212" \
        password "$(cat /data/secret)" \
)

if bashio::discovery "vlc_telnet" "${ha_config}" > /dev/null; then
    bashio::log.info "Successfully send discovery information to Home Assistant."
else
    bashio::log.error "Discovery message to Home Assistant failed!"
fi

